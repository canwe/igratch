(function($){$.fn.upload=function(settings){var options=$.extend(true,{block_size:5*1024*1024,progressClass:"progress-striped",preview:false,value:"",beginUpload:function(){},deliverSlice:function(){},queryFile:function(){},complete:function(){}},settings);return this.filter('input[type="file"]').each(function(){return $.Upload(this,options)})};$.Upload=function(input,options){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return false;var $input=$(input);var self=this;var pid;var reader;var block_size=options.block_size;var cancelled_upload;var paused_upload;var start_time;var file;var file_index=0;var start_file_index;var browse_btn=$("<a>",{href:"#",title:"Browse"}).on("click",function(e){$input.trigger("click");e.preventDefault()}).append($("<i>",{"class":"icon-upload icon-2x"}));var upload_btn=$("<a>",{href:"#",title:"Upload"}).on("click",function(e){begin_upload();e.preventDefault()}).hide().append($("<i>",{"class":"icon-play-circle icon-2x"}));var reupload_btn=$("<a>",{href:"#",title:"Reupload"}).on("click",function(e){file_index=0;begin_upload();e.preventDefault()}).append($("<i>",{"class":"icon-refresh icon-light icon-2x"}));var resume_btn=$("<a>",{href:"#",title:"Resume"}).on("click",function(e){begin_upload();e.preventDefault()}).append($("<i>",{"class":"icon-play-circle icon-2x"}));var cancel_btn=$("<a>",{href:"#","class":"text-error",title:"Cancel"}).on("click",function(e){reset_upload();progress_label.html("");cancelled_upload=true;preview.html("");e.preventDefault()}).append($("<i>",{"class":"icon-remove icon-2x"}));var pause_btn=$("<a>",{href:"#","class":"",title:"Pause"}).on("click",function(e){paused_upload=true;pause_btn.hide();resume_btn.show();progress_label.html("");e.preventDefault()}).append($("<i>",{"class":"icon-pause icon-large"}));var etainfo=$("<span/>",{"class":"info"});var info=$("<span/>",{"class":"info",name:"info"});var progress_bar=$("<div/>",{"class":"bar",style:"width:0;"}).on("progress-changed",function(e,progress){progress_bar.css("width",progress+"%");if(progress===48){$("i",pause_btn).addClass("icon-light");$("i",resume_btn).addClass("icon-light")}progress_bar.css("width",progress+"%")});var progress_label=$("<div/>",{"class":"progress-label"});var progress_ctl=$("<div/>",{"class":"progress-ctl"}).append(upload_btn,pause_btn,resume_btn,reupload_btn);var progress=$("<div/>",{"class":"progress progress-info "+options.progressClass}).append(progress_bar,progress_label,progress_ctl);var ctl=$("<div/>",{"class":"ctl"}).append(cancel_btn,info,etainfo,browse_btn);var preview=$("<div/>",{"class":"preview"});$input.wrap("<div class='file_upload' contenteditable='false'></div>").hide().parent().append(preview,progress,ctl);if(options.value!=="undefined"){preview.html("<img src='"+options.value+"'/>")}var file_buttons=$("a",$input.parent());$input.on("change",function(e){file=this.files[0];if(!file)return;info.html("&nbsp;&nbsp;"+file.name+"&nbsp;&nbsp;");progress_label.html("");file_buttons.hide();browse_btn.show();upload_btn.show();cancel_btn.show();progress_bar.css("width","0");if(options.preview=="true"&&file.type.match("image*")){reader=new FileReader;reader.onload=function(f){return function(e){preview.html($("<img/>",{src:e.target.result,title:f.name,width:preview.width()}))}}(file);reader.readAsDataURL(file)}else{preview.html("")}var type=file.type===""?Bert.atom("undefined"):Bert.binary(file.type);options.queryFile(Bert.tuple(Bert.atom("query"),Bert.binary(file.name),type))}).on("exist",function(e,fileSize){file_index=0;var size=parseInt(fileSize);if(size>0){file_index=size;file_buttons.hide();browse_btn.show();reupload_btn.show();if(file_index<file.size){resume_btn.show();progress_label.html("Upload incomplete")}else{progress_label.html("File exists")}update_progress_bar()}}).on("begin_upload",function(e,pid){self.pid=pid;read_slice(file_index,block_size)}).on("upload",function(e,fileSize){var size=parseInt(fileSize);if(!paused_upload&&!cancelled_upload&&file_index<file.size){read_slice(file_index,file_index+block_size)}if(paused_upload)progress_label.html("");if(cancelled_upload){reset_upload();progress_label.html("")}}).on("error",function(e,msg){error(msg)}).on("reset",function(e){reset_upload()});function reset_upload(){file_buttons.hide();browse_btn.show();cancelled_upload=false;paused_upload=false;preview.html("");info.html("");progress_label.html("");progress_bar.css("width","0");$("i",pause_btn).removeClass("icon-light");$("i",resume_btn).removeClass("icon-light")}function error(message){console.log("error "+message);reset_upload();$("<div/>",{"class":"alert alert-error"}).append($("<button>",{type:"button","class":"close","data-dismiss":"alert"}).html("&times;")).append(message).prependTo($input.parent());$(".progress-info",$input.parent()).removeClass("progress-info").addClass("progress-danger");progress_bar.css("width","100%");progress_label.html(message)}function onabort(event){error("File upload aborted");reader.abort()}function onerror(event){switch(event.target.error.code){case event.target.error.NOT_FOUND_ERR:error("File not found");break;case event.target.error.NOT_READABLE_ERR:error("File is not readable");break;case event.target.error.ABORT_ERR:error("File upload aborted");break;default:error("An error occurred reading the file.")}}function onloadend(event){if(event.target.readyState==FileReader.DONE){if(options.deliverSlice(Bert.tuple(Bert.atom("upload"),Bert.binary(self.pid),Bert.binary(event.target.result)))==false){error("Error delivering data to server");return}file_index+=block_size;calculate_eta();update_progress_bar();if(file_index>=file.size){file_buttons.hide();browse_btn.show();progress_label.html("Upload complete");etainfo.html("");options.complete(Bert.tuple(Bert.atom("complete"),Bert.binary(self.pid)))}}}function calculate_eta(){var delta_ms=Date.now()-start_time;var rate=(file_index-start_file_index)/delta_ms;var remaining_ms=(file.size-file_index)/rate;if(remaining_ms<0)return;var delta_hr=parseInt(Math.floor(remaining_ms/36e5));remaining_ms-=delta_hr*36e5;var delta_min=parseInt(Math.floor(remaining_ms/6e4));remaining_ms-=delta_min*6e4;var delta_sec=parseInt(Math.floor(remaining_ms/1e3));var eta="";if(delta_sec>=0)eta=delta_sec+1+" secs";if(delta_min>0)eta=delta_min+" mins";if(delta_hr>0)eta=delta_hr+" hours";etainfo.html(eta)}function update_progress_bar(){var progress=Math.floor(100*(file_index/file.size));if(progress_bar[0].style.width!==progress+"%"){progress_bar.trigger("progress-changed",[progress])}}function read_slice(start,end){reader=new FileReader;reader.onabort=onabort;reader.onerror=onerror;reader.onloadend=onloadend;var blob=file.slice(start,end);reader.readAsBinaryString(blob)}function begin_upload(){file_buttons.hide();pause_btn.show();cancel_btn.show();progress_label.html("");start_time=Date.now();start_file_index=file_index;if(paused_upload)paused_upload=false;var type=file.type===""?Bert.atom("undefined"):Bert.binary(file.type);options.beginUpload(Bert.tuple(Bert.atom("begin_upload"),Bert.binary(file.name),type))}reset_upload();return this}})(window.jQuery||window.Zepto); !function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.collapse.defaults,options);if(this.options.parent){this.$parent=$(this.options.parent)}this.options.toggle&&this.toggle()};Collapse.prototype={constructor:Collapse,dimension:function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"},show:function(){var dimension,scroll,actives,hasData;if(this.transitioning||this.$element.hasClass("in"))return;dimension=this.dimension();scroll=$.camelCase(["scroll",dimension].join("-"));actives=this.$parent&&this.$parent.find("> .accordion-group > .in");if(actives&&actives.length){hasData=actives.data("collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("collapse",null)}this.$element[dimension](0);this.transition("addClass",$.Event("show"),"shown");$.support.transition&&this.$element[dimension](this.$element[0][scroll])},hide:function(){var dimension;if(this.transitioning||!this.$element.hasClass("in"))return;dimension=this.dimension();this.reset(this.$element[dimension]());this.transition("removeClass",$.Event("hide"),"hidden");this.$element[dimension](0)},reset:function(size){var dimension=this.dimension();this.$element.removeClass("collapse")[dimension](size||"auto")[0].offsetWidth;this.$element[size!==null?"addClass":"removeClass"]("collapse");return this},transition:function(method,startEvent,completeEvent){var that=this,complete=function(){if(startEvent.type=="show")that.reset();that.transitioning=0;that.$element.trigger(completeEvent)};this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;this.transitioning=1;this.$element[method]("in");$.support.transition&&this.$element.hasClass("collapse")?this.$element.one($.support.transition.end,complete):complete()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this),data=$this.data("collapse"),options=$.extend({},$.fn.collapse.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})};$.fn.collapse.defaults={toggle:true};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this};$(document).on("click.collapse.data-api","[data-toggle=collapse]",function(e){var $this=$(this),href,target=$this.attr("data-target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""),option=$(target).data("collapse")?"toggle":$this.data();$this[$(target).hasClass("in")?"addClass":"removeClass"]("collapsed");$(target).collapse(option)})}(window.jQuery); !function($){"use strict";var toggle="[data-toggle=dropdown]",Dropdown=function(element){var $el=$(element).on("click.dropdown.data-api",this.toggle);$("html").on("click.dropdown.data-api",function(){$el.parent().removeClass("open")})};Dropdown.prototype={constructor:Dropdown,toggle:function(e){var $this=$(this),$parent,isActive;if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement){$('<div class="dropdown-backdrop"/>').insertBefore($(this)).on("click",clearMenus)}$parent.toggleClass("open")}$this.focus();return false},keydown:function(e){var $this,$items,$active,$parent,isActive,index;if(!/(38|40|27)/.test(e.keyCode))return;$this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;$parent=getParent($this);isActive=$parent.hasClass("open");if(!isActive||isActive&&e.keyCode==27){if(e.which==27)$parent.find(toggle).focus();return $this.click()}$items=$("[role=menu] li:not(.divider):visible a",$parent);if(!$items.length)return;index=$items.index($items.filter(":focus"));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus()}};function clearMenus(){$(".dropdown-backdrop").remove();$(toggle).each(function(){getParent($(this)).removeClass("open")})}function getParent($this){var selector=$this.attr("data-target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=selector&&$(selector);if(!$parent||!$parent.length)$parent=$this.parent();return $parent}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this};$(document).on("click.dropdown.data-api",clearMenus).on("click.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.dropdown.data-api",toggle+", [role=menu]",Dropdown.prototype.keydown)}(window.jQuery); !function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype={constructor:Tab,show:function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.attr("data-target"),previous,$target,e;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;previous=$ul.find(".active:last a")[0];e=$.Event("show",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;$target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown",relatedTarget:previous})})},activate:function(element,container,callback){var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next):next();$active.removeClass("in")}};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data("tab");if(!data)$this.data("tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};$(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})}(window.jQuery); !function(t){function e(){function e(t){"remove"===t&&this.each(function(t,e){var n=r(e);n&&n.remove()}),this.find("span.mceEditor,div.mceEditor").each(function(t,e){var n=tinymce.get(e.id.replace(/_parent$/,""));n&&n.remove()})}function i(t){var n,i=this;if(null!=t)e.call(i),i.each(function(e,n){var i;(i=tinymce.get(n.id))&&i.setContent(t)});else if(i.length>0&&(n=tinymce.get(i[0].id)))return n.getContent()}function r(t){var e=null;return t&&t.id&&a.tinymce&&(e=tinymce.get(t.id)),e}function c(t){return!!(t&&t.length&&a.tinymce&&t.is(":tinymce"))}var u={};t.each(["text","html","val"],function(e,a){var o=u[a]=t.fn[a],s="text"===a;t.fn[a]=function(e){var a=this;if(!c(a))return o.apply(a,arguments);if(e!==n)return i.call(a.filter(":tinymce"),e),o.apply(a.not(":tinymce"),arguments),a;var u="",l=arguments;return(s?a:a.eq(0)).each(function(e,n){var i=r(n);u+=i?s?i.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):i.getContent({save:!0}):o.apply(t(n),l)}),u}}),t.each(["append","prepend"],function(e,i){var a=u[i]=t.fn[i],o="prepend"===i;t.fn[i]=function(t){var e=this;return c(e)?t!==n?(e.filter(":tinymce").each(function(e,n){var i=r(n);i&&i.setContent(o?t+i.getContent():i.getContent()+t)}),a.apply(e.not(":tinymce"),arguments),e):void 0:a.apply(e,arguments)}}),t.each(["remove","replaceWith","replaceAll","empty"],function(n,i){var r=u[i]=t.fn[i];t.fn[i]=function(){return e.call(this,i),r.apply(this,arguments)}}),u.attr=t.fn.attr,t.fn.attr=function(e,a){var o=this,s=arguments;if(!e||"value"!==e||!c(o))return a!==n?u.attr.apply(o,s):u.attr.apply(o,s);if(a!==n)return i.call(o.filter(":tinymce"),a),u.attr.apply(o.not(":tinymce"),s),o;var l=o[0],p=r(l);return p?p.getContent({save:!0}):u.attr.apply(t(l),s)}}var n,i,r=[],a=window;t.fn.tinymce=function(n){function c(){var i=[],r=0;e&&(e(),e=null),l.each(function(t,e){var a,c=e.id,u=n.oninit;c||(e.id=c=tinymce.DOM.uniqueId()),tinymce.get(c)||(a=new tinymce.Editor(c,n,tinymce.EditorManager),i.push(a),a.on("init",function(){var t,e=u;l.css("visibility",""),u&&++r==i.length&&("string"==typeof e&&(t=-1===e.indexOf(".")?null:tinymce.resolve(e.replace(/\.\w+$/,"")),e=tinymce.resolve(e)),e.apply(t||tinymce,i))}))}),t.each(i,function(t,e){e.render()})}var u,o,s,l=this,p="";if(!l.length)return l;if(!n)return tinymce.get(l[0].id);if(l.css("visibility","hidden"),a.tinymce||i||!(u=n.script_url))1===i?r.push(c):c();else{i=1,o=u.substring(0,u.lastIndexOf("/")),-1!=u.indexOf(".min")&&(p=".min"),a.tinymce=a.tinyMCEPreInit||{base:o,suffix:p},-1!=u.indexOf("gzip")&&(s=n.language||"en",u=u+(/\?/.test(u)?"&":"?")+"js=true&core=true&suffix="+escape(p)+"&themes="+escape(n.theme)+"&plugins="+escape(n.plugins)+"&languages="+s,a.tinyMCE_GZ||(a.tinyMCE_GZ={start:function(){function e(t){tinymce.ScriptLoader.markDone(tinymce.baseURI.toAbsolute(t))}e("langs/"+s+".js"),e("themes/"+n.theme+"/theme"+p+".js"),e("themes/"+n.theme+"/langs/"+s+".js"),t.each(n.plugins.split(","),function(t,n){n&&(e("plugins/"+n+"/plugin"+p+".js"),e("plugins/"+n+"/langs/"+s+".js"))})},end:function(){}}));var f=document.createElement("script");f.type="text/javascript",f.onload=f.onreadystatechange=function(e){e=e||event,("load"==e.type||/complete|loaded/.test(f.readyState))&&(tinymce.dom.Event.domLoaded=1,i=2,n.script_loaded&&n.script_loaded(),c(),t.each(r,function(t,e){e()}))},f.src=u,document.body.appendChild(f)}return l},t.extend(t.expr[":"],{tinymce:function(t){return!!(t.id&&"tinymce"in window&&tinymce.get(t.id))}})}(jQuery); !function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.button.defaults,options)};Button.prototype.setState=function(state){var d="disabled",$el=this.$element,data=$el.data(),val=$el.is("input")?"val":"html";state=state+"Text";data.resetText||$el.data("resetText",$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=="loadingText"?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d)},0)};Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons-radio"]');$parent&&$parent.find(".active").removeClass("active");this.$element.toggleClass("active")};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this),data=$this.data("button"),options=typeof option=="object"&&option;if(!data)$this.data("button",data=new Button(this,options));if(option=="toggle")data.toggle();else if(option)data.setState(option)})};$.fn.button.defaults={loadingText:"loading..."};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn"))$btn=$btn.closest(".btn");$btn.button("toggle")})}(window.jQuery); !function($){"use strict";var dismiss='[data-dismiss="alert"]',Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){var $this=$(this),selector=$this.attr("data-target"),$parent;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}$parent=$(selector);e&&e.preventDefault();$parent.length||($parent=$this.hasClass("alert")?$this:$this.parent());$parent.trigger(e=$.Event("close"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.trigger("closed").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.on($.support.transition.end,removeElement):removeElement()};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this),data=$this.data("alert");if(!data)$this.data("alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this};$(document).on("click.alert.data-api",dismiss,Alert.prototype.close)}(window.jQuery); !function($){"use strict";$(function(){$.support.transition=function(){var transitionEnd=function(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},name;for(name in transEndEventNames){if(el.style[name]!==undefined){return transEndEventNames[name]}}}();return transitionEnd&&{end:transitionEnd}}()})}(window.jQuery);
